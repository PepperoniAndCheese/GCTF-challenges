#!/usr/bin/env python3
'''
Created on Dec 14, 2011

@author: pablocelayes
'''

import ContinuedFractions, Arithmetic

def hack_RSA(e,n):
	frac = ContinuedFractions.rational_to_contfrac(e, n)
	convergents = ContinuedFractions.convergents_from_contfrac(frac)
	
	for (k,d) in convergents:
		
		#check if d is actually the key
		if k!=0 and (e*d-1)%k == 0:
			phi = (e*d-1)//k
			s = n - phi + 1
			# check if the equation x^2 - s*x + n = 0
			# has integer roots
			discr = s*s - 4*n
			if(discr>=0):
				t = Arithmetic.is_perfect_square(discr)
				if t!=-1 and (s+t)%2==0:
					return d

print(hack_RSA(320065120544888996178580792961919565592315662962187971162935684141532866941035748535587812517974637182500902099489536634115377524552754484872207247589178744360141791250757706441172336286091032283294344155338085552562801008021662914068552522973355567403301067783442908158098531375352356980814518266431605393813,378446712747040981176806241381890627831830071561164419776894629191055505978344452858685832790566154883109356442631993310300342035313064203787581748624340508454727159465630394334988529248775058628225418583196186978273906019758731091528403340179239192815556936603075472765914619648300022799176306707269026810349))
